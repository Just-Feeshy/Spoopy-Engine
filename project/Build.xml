<xml>
    <include name="${HXCPP}/build-tool/BuildCommon.xml"/>

    <set name="tool" value="exe" unless="iphone"/>
	<set name="tool" value="static" if="iphone"/>

    <set name="NATIVE_TOOLKIT_PATH" value="lib" unless="NATIVE_TOOLKIT_PATH" />

    <set name="SPOOPY_SDL" value="1" />
    <set name="SPOOPY_VULKAN" value="1" />

    <include name="${NATIVE_TOOLKIT_PATH}/sdl/files.xml" if="SPOOPY_SDL" />

    <section if="windows">
        <include name="${HXCPP}/toolchain/msvc-toolchain.xml"/>
    </section>

    <section if="macos">
        <set name="HXCPP_CLANG" value="1" />
        <include name="${HXCPP}/toolchain/mac-toolchain.xml"/>
    </section>

    <section if="linux">
        <include name="${HXCPP}/toolchain/linux-toolchain.xml"/>
    </section>

    <files id="native-toolkit-sdl-extensions">
        <depend name="${NATIVE_TOOLKIT_PATH}/sdl/include/SDL_vulkan.h" />

        <file name="${NATIVE_TOOLKIT_PATH}/sdl/src/video/khronos/vulkan/vk_icd.h" />
        <file name="${NATIVE_TOOLKIT_PATH}/sdl/src/video/khronos/vulkan/vk_layer.h" />
        <file name="${NATIVE_TOOLKIT_PATH}/sdl/src/video/khronos/vulkan/vk_platform.h" />
        <file name="${NATIVE_TOOLKIT_PATH}/sdl/src/video/khronos/vulkan/vk_sdk_platform.h" />
        <file name="${NATIVE_TOOLKIT_PATH}/sdl/src/video/khronos/vulkan/vulkan_fuchsia.h" />
        <file name="${NATIVE_TOOLKIT_PATH}/sdl/src/video/khronos/vulkan/vulkan_core.h" />
        <file name="${NATIVE_TOOLKIT_PATH}/sdl/src/video/khronos/vulkan/vulkan.h" />
        <file name="${NATIVE_TOOLKIT_PATH}/sdl/src/video/khronos/vulkan/vulkan_mir.h" />
        <file name="${NATIVE_TOOLKIT_PATH}/sdl/src/video/khronos/vulkan/vulkan_vi.h" />
        <file name="${NATIVE_TOOLKIT_PATH}/sdl/src/video/khronos/vulkan/vulkan_wayland.h" />
        <file name="${NATIVE_TOOLKIT_PATH}/sdl/src/video/khronos/vulkan/vulkan_xcb.h" />
        <file name="${NATIVE_TOOLKIT_PATH}/sdl/src/video/khronos/vulkan/vulkan_xlib_xrandr.h" />
        <file name="${NATIVE_TOOLKIT_PATH}/sdl/src/video/khronos/vulkan/vulkan_xlib.h" />

        <file name="${NATIVE_TOOLKIT_PATH}/sdl/src/video/khronos/vulkan/vulkan_android.h" if="android" />
        <file name="${NATIVE_TOOLKIT_PATH}/sdl/src/video/khronos/vulkan/vulkan_ios.h" if="ios" />
        <file name="${NATIVE_TOOLKIT_PATH}/sdl/src/video/khronos/vulkan/vulkan_macos.h" if="mac" />

        <section if="32">
            <file name="${NATIVE_TOOLKIT_PATH}/sdl/src/video/khronos/vulkan/vulkan_win32.h" if="windows" />
        </section>
    </files>

    <files id="spoopy-engine">
        <compilerflag value="-Iinclude"/>

        <compilerflag value="-DENABLED_SDL" />

        <compilerflag value="-I${NATIVE_TOOLKIT_PATH}/hashlink/src" />

        <section if="hashlink">
			<compilerflag value="-DLIME_HASHLINK" />
		</section>

        <section if="hashlink">
			<compilerflag value="-DLIBHL_EXPORTS" />
		</section>

        <section unless="emscripten">
            <compilerflag value="-I${NATIVE_TOOLKIT_PATH}/sdl/include/" />
            <compilerflag value="-I${NATIVE_TOOLKIT_PATH}/sdl/include/configs/default/" unless="windows || mac || linux || rpi"/>
            <compilerflag value="-I${NATIVE_TOOLKIT_PATH}/sdl/include/configs/linux/" if="linux" unless="rpi"/>
            <compilerflag value="-I${NATIVE_TOOLKIT_PATH}/sdl/include/configs/windows/" if="windows" unless="winrt"/>
            <compilerflag value="-I${NATIVE_TOOLKIT_PATH}/sdl/include/configs/mac/" if="mac"/>
            <compilerflag value="-I${NATIVE_TOOLKIT_PATH}/sdl/include/configs/rpi/" if="rpi"/>
            <compilerflag value="-I${NATIVE_TOOLKIT_PATH}/sdl/include/configs/winrt/" if="winrt"/>
            <compilerflag value="-I${NATIVE_TOOLKIT_PATH}/sdl/src/video/khronos/" />

            <include name="${NATIVE_TOOLKIT_PATH}/sdl/defines.xml" />

            <compilerflag value="-DSPOOPY_VULKAN" if="SPOOPY_VULKAN" />
        </section>

	    <file name="src/SpoopyBackend.cpp" />
        <file name="src/device/WindowDevice.cpp" />
        <file name="src/device/DeviceManager.cpp" />
        <file name="src/system/CFFI.cpp" />
        <file name="src/system/CFFIPointer.cpp" />
    </files>

    <target id="LIB" output="spoopy" tool="linker" toolid="${STD_MODULE_LINK}">
        <outdir name="../ndll/${BINDIR}"/>
        <files id="spoopy-engine" />

        <files id="native-toolkit-sdl" if="SPOOPY_SDL" unless="emscripten" />
        <!--<files id="native-toolkit-sdl-extensions" if="SPOOPY_SDL" unless="emscripten" />-->

        <section if="static_link">
            <section if="mac">
                <vflag name="-l" value="iconv"/>
                <vflag name="-framework" value="Carbon" />
                <vflag name="-framework" value="Cocoa" />
                <vflag name="-framework" value="Foundation" />
                <vflag name="-framework" value="CoreVideo" />
                <vflag name="-framework" value="OpenGL" />
                <vflag name="-framework" value="ForceFeedback" />
                <vflag name="-framework" value="IOKit" />
                <vflag name="-framework" value="CoreAudio" />
                <vflag name="-framework" value="AudioUnit" />

                <lib name="-L../templates/bin/hl/${BINDIR}" if="hashlink" />
                <lib name="-lhl" if="hashlink" />
            </section>

            <section if="windows">
                <lib name="gdi32.lib" />
                <lib name="opengl32.lib" />
                <lib name="user32.lib" />
                <lib name="kernel32.lib" />
                <lib name="advapi32.lib" />
                <lib name="winmm.lib" />
                <lib name="imm32.lib"  />
                <lib name="ole32.lib" />
                <lib name="oleaut32.lib" />
                <lib name="version.lib" />
                <lib name="ws2_32.lib"  />
                <lib name="wldap32.lib" />
                <lib name="shell32.lib" />
                <lib name="comdlg32.lib" />
            </section>

            <section if="android">
                <lib name="-Wl,--undefined=Java_org_libsdl_app_SDLActivity_nativeInit" if="SNOW_USE_SDL"/>
                <lib name="-ldl" />
                <lib name="-llog" />
                <lib name="-landroid" />
                <lib name="-lEGL" />
                <lib name="-lGLESv2" />
                <lib name="-lGLESv1_CM" />
            </section>

            <section if="linux">
                <lib name="-lpthread" />
                <lib name="-lrt" />
                <lib name="-lGL" />
            </section>

            <ext value=".ndll" />
        </section>
    </target>

    <target id="default">
	    <target id="LIB" />
    </target>
</xml>